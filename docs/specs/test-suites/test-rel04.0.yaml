id: test-rel04.0
title: "Test Suite: Release 04.0 â€” Inspect, Mend, and Pattern"
release: rel04.0

traces:
  - rel04.0-uc001-project-state-display
  - rel04.0-uc002-test-lint-fix-loop
  - rel04.0-uc003-design-proposals
  - rel04.0-uc004-property-based-testing
  - rel04.0-uc005-contract-injection

preconditions:
  - Stitch has completed at least one task cycle
  - Quality gate tools available (go test, golangci-lint, go build)
  - Cupboard contains recent crumb state transitions

test_cases:
  - use_case: rel04.0-uc001-project-state-display
    name: Inspect displays recent outcomes
    description: Verify inspect collects and displays recent task outcomes.
    inputs:
      recent_crumbs_exist: true
    expected:
      report_generated: true
      recent_outcomes_included: true
      quality_metrics_present: true
      no_code_changes_made: true

  - use_case: rel04.0-uc002-test-lint-fix-loop
    name: Mend fixes failing tests
    description: Verify mend agent receives error details and produces a fix.
    inputs:
      test_failure: "TestFoo expected 42 got 0"
    expected:
      fix_attempted: true
      quality_gates_rerun: true
      crumb_state_on_success: completed

  - use_case: rel04.0-uc002-test-lint-fix-loop
    name: Mend retry limit
    description: Verify mend stops after retry limit and marks for human review.
    inputs:
      persistent_failure: true
      max_retries: 2
    expected:
      retries_attempted: 2
      marked_for_human_review: true

  - use_case: rel04.0-uc003-design-proposals
    name: Pattern produces design proposals
    description: Verify pattern agent outputs actionable design proposals.
    inputs:
      path_health_degraded: true
    expected:
      proposals_generated: true
      proposals_are_crumbs: true
      proposals_actionable: true

  - use_case: rel04.0-uc004-property-based-testing
    name: Type presence properties derived from requirements
    description: Verify deriver produces type presence properties from "must track X, Y, Z" patterns.
    inputs:
      requirement_text: "Response.Usage must track InputTokens, OutputTokens"
    expected:
      properties_derived: true
      property_category: type_presence
      property_count_positive: true

  - use_case: rel04.0-uc004-property-based-testing
    name: Ambiguous requirements reported as warnings
    description: Verify requirements that do not match patterns are warnings not failures.
    inputs:
      requirement_text: "The system should generally work well"
    expected:
      properties_derived: false
      warning_reported: true
      score_not_penalized: true

  - use_case: rel04.0-uc004-property-based-testing
    name: Property violations traced to requirement ID
    description: Verify failing properties include the source requirement ID and counterexample.
    inputs:
      property_fails: true
    expected:
      report_has_requirement_id: true
      report_has_property_description: true
      report_has_counterexample: true

  - use_case: rel04.0-uc005-contract-injection
    name: Precondition generated from must-receive pattern
    description: Verify injector produces precondition assertion from "must receive X" requirement.
    inputs:
      requirement_text: "Agent.Run must receive a non-empty prompt"
    expected:
      contract_type: precondition
      assertion_generated: true
      build_tag_present: true

  - use_case: rel04.0-uc005-contract-injection
    name: Contracts injected into copies not originals
    description: Verify original source files are unchanged after contract injection.
    inputs:
      source_files: ["agent.go"]
    expected:
      original_unchanged: true
      copy_has_contracts: true

  - use_case: rel04.0-uc005-contract-injection
    name: Contract violation includes requirement ID
    description: Verify a triggered contract violation reports the source requirement ID.
    inputs:
      contract_violated: true
    expected:
      report_has_requirement_id: true
      report_has_expected_condition: true
      report_has_actual_value: true
